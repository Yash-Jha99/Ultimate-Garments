import{r as i,a as I,b as q,j as e,h as f,g as W,C as A,T as j,S as w,P as B,B as L,ar as V,K,e as v,as as U,at as _,au as $,L as G,av as Y,p as y,aw as O}from"./index-13a4e5ec.js";const J=()=>{const[S,x]=i.useState(!1),[k,T]=i.useState(!1),[u,d]=i.useState(null),[c,b]=i.useState(0),[D,C]=i.useState(!1),[r,h]=i.useState({mobileNumber:!1,name:!1,email:!1,otp:!1}),[n,g]=i.useState({mobileNumber:"",otp:"",name:"",email:"",notify:!1}),N=I(),{enqueueSnackbar:z}=q(),F=()=>{b(0),g({mobileNumber:"",otp:"",name:"",email:"",notify:!1}),x(!1)},P=async()=>{const{mobileNumber:a}=n;if(a.trim()===""||a.trim().length!==10||isNaN(Number(a))){h({...r,mobileNumber:!0});return}C(!0);try{window.otpResult=await Y(a);const t=await y("auth/login",{mobileNumber:a});if(t){const{isRegistered:s}=t.data;b(30),x(!0),T(!s)}}catch(t){console.log(t),z("Something went wrong...",{variant:"error"})}C(!1)},m=async a=>{const{name:t,value:s,checked:p}=a.target;if(r[t]=!1,d(null),t==="otp")if(s.length!==6)d(null);else{g(o=>({...o,otp:s}));try{await window.otpResult.confirm(s);const o=await y("auth/validate",{otp:s,mobileNumber:n.mobileNumber});o.status===200&&(d(!0),o.data&&N(O({token:o.data})))}catch{d(!1)}}t==="mobileNumber"&&S&&(x(!1),g({...n,otp:"",name:"",email:""}));let l={[t]:s};t==="notify"&&(l={[t]:p}),g(o=>({...o,...l}))},E=async()=>{const{email:a,name:t,otp:s}=n;if(s.trim().length===0||!u)return h({...r,otp:!0});if(t.trim().length===0)return h({...r,name:!0});if(a.trim().length===0)return h({...r,email:!0});const p={...n};delete p.otp;const l=await y("user",p);if(l.status===400)return alert(l.data);N(O({token:l.data})),F()};i.useEffect(()=>{const a=setInterval(()=>{c>0?b(t=>t-1):clearInterval(a)},1e3);return()=>clearInterval(a)},[c]);const R=e.jsxs(e.Fragment,{children:[e.jsx(f,{error:r.name,color:"text",label:"Full Name",margin:"dense",required:!0,size:"small",fullWidth:!0,value:n.name,onChange:m,name:"name"}),e.jsx(f,{error:r.email,color:"text",type:"email",label:"Email Address",margin:"dense",required:!0,size:"small",fullWidth:!0,value:n.email,onChange:m,name:"email"}),e.jsx(W,{sx:{fontSize:"10px"},control:e.jsx(A,{color:"secondary",checked:n.notify,onChange:m,name:"notify"}),label:e.jsx(j,{variant:"body2",children:"Yes, Keep me posted with current offers, new arrivals, sale and contest"})})]});return e.jsx(w,{justifyContent:"center",alignItems:"center",height:"75vh",children:e.jsx(B,{elevation:2,children:e.jsxs(L,{width:"40%",textAlign:"center",pt:2,sx:{width:{xs:360,sm:440},mx:"auto"},children:[e.jsx(j,{variant:"h5",children:"Login/Sign Up to explore great designs"}),e.jsxs(V,{children:["Login / Signup",e.jsx("div",{style:{fontSize:12,fontWeight:"normal"},children:"Get Exciting Offers & Track Order"})]}),e.jsxs(K,{children:[e.jsx(f,{error:r.mobileNumber,color:"text",inputProps:{pattern:"[0-9]{10}",maxLength:10},label:"Phone Number",name:"mobileNumber",onChange:m,value:n.mobileNumber,margin:"dense",required:!0,size:"small",fullWidth:!0}),S?e.jsxs(w,{spacing:2,direction:"column",children:[!u&&e.jsx(L,{display:"flex",mb:-3,justifyContent:"flex-end",children:e.jsxs(v,{disabled:c!==0,onClick:P,color:"secondary",children:["Resend OTP",c!==0&&` in ${c} s`]})}),e.jsx(f,{error:r.otp,InputProps:{endAdornment:n.otp.length===6&&e.jsxs(U,{position:"end",children:[u===!0&&e.jsx(_,{color:"success"}),u===!1&&e.jsx($,{color:"error"})]})},inputProps:{maxLength:6},color:"text",label:"Enter 6 Digit OTP",margin:"normal",size:"small",fullWidth:!0,value:n.otp,onChange:m,name:"otp"}),k&&R,e.jsx(v,{variant:"contained",sx:{bgcolor:"black",":hover":{bgcolor:"black"},color:"white"},onClick:E,children:k?"Sign Up":"Verify"})]}):e.jsx(e.Fragment,{children:e.jsx(v,{sx:{mt:2,bgcolor:"black",":hover":{bgcolor:"black"},color:"white"},variant:"contained",id:"sign-in-button",onClick:P,children:e.jsxs(w,{direction:"row",spacing:2,children:[D&&e.jsx(G,{size:20,height:"100%",color:"inherit"}),e.jsx(j,{whiteSpace:"nowrap",fontSize:14,children:"Login with OTP"})]})})})]})]})})})};export{J as default};
